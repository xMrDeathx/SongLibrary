# Тестовое задание "Онлайн библиотека песен"

## Задачи

### 1. REST Методы
- **Получение списка песен** с фильтрацией по всем полям и пагинацией.
- **Получение текста песни** с поддержкой пагинации по куплетам.
- **Удаление песни** по её идентификатору.
- **Изменение данных песни** по её идентификатору (обновление информации).
- **Добавление новой песни** в формате JSON:

```json
{
  "group": "Muse",
  "song": "Supermassive Black Hole"
}
```
### 2. Интеграция с внешним API
При добавлении новой песни происходит запрос в API, описанное в формате OpenAPI:

- **Метод**: GET /info
- **Параметры**: group (название группы) и song (название песни).
- **Ответ**: Обогащенная информация о песне, включающая releaseDate, text и link на источник.

### 3. Работа с базой данных: обогащение информации о песне и её сохранение в базе данных PostgreSQL. Структура БД создаётся с помощью миграций при старте сервиса.

### 4. Покрытие кода DEBUG и INFO логами

### 5. Конфигурационные данные в .env файле

### 6. Генерация Swagger


## Для ручного запуска:
1. `go install github.com/deepmap/oapi-codegen/v2/cmd/oapi-codegen@v2.0.0`
2. `oapi-codegen -generate gorilla,types songlibrary/api/frontend/frontendapi.yaml > songlibrary/api/frontend/frontendapi.gen.go`
3. `go mod tidy -v`
4. `go run main.go`

## Для работы с БД
1. Установить PostgreSQL
2. Миграции выполняются автоматически

## Миграции
up и down миграции выполняются автоматически при запуске приложения

[Инструкция по установке утилиты для миграций](https://github.com/golang-migrate/migrate/blob/master/cmd/migrate/README.md)

Создание миграции: `migrate create -ext sql -dir {path-to-migrations-dir} {migartion-name}`

## Основные маршруты API

- **POST /info** - Получение информации о песне из внешнего API и добавление обогащённой информации в БД.
- **GET /songs** - Получение списка песен с возможностью фильтрации и пагинации.
- **GET /songs/{id}/verses** - Получение текста песни по её ID с пагинацией по куплетам.
- **PUT /songs/{id}** - Обновление информации о песне по её ID.
- **DELETE /songs/{id}** - Удаление песни по её ID.

## Зависимости

Проект использует следующие библиотеки:

- **Gorilla Mux**: HTTP-маршрутизатор для Go.
- **pgx**: Драйвер для работы с базой данных PostgreSQL.
- **oapi**: Инструмент для генерации Go-кода на основе спецификаций OpenAPI.
- **godotenv**: Для загрузки переменных окружения из файла .env.